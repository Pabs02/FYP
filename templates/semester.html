{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
	<h2>ğŸ“… Active Semester</h2>
	<a href="/" class="btn btn-outline-secondary">â† Back to Dashboard</a>
</div>

<form class="row g-2 mb-4" method="GET">
	<div class="col-md-4">
		<label class="form-label">Start date</label>
		<input type="date" class="form-control" name="start" value="{{ start_date }}">
	</div>
	<div class="col-md-4">
		<label class="form-label">End date</label>
		<input type="date" class="form-control" name="end" value="{{ end_date }}">
	</div>
	<div class="col-md-4 d-flex align-items-end gap-2">
		<button class="btn btn-primary w-100" type="submit">Apply</button>
		<button class="btn btn-outline-secondary w-100" type="submit" name="save" value="1">Save range</button>
	</div>
</form>

<div class="row g-3 mb-4">
	<div class="col-md-3">
		<div class="card">
			<div class="card-body">
				<div class="text-muted small">Assignments</div>
				<div class="fs-4 fw-semibold">{{ total_tasks }}</div>
				<div class="small text-muted">Completed: {{ status_counts.completed }}</div>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card">
			<div class="card-body">
				<div class="text-muted small">Events</div>
				<div class="fs-4 fw-semibold">{{ total_events }}</div>
				<div class="small text-muted">In range</div>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card">
			<div class="card-body">
				<div class="text-muted small">Reviews</div>
				<div class="fs-4 fw-semibold">{{ total_reviews }}</div>
				<div class="small text-muted">In range</div>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card">
			<div class="card-body">
				<div class="text-muted small">Microtasks</div>
				<div class="fs-4 fw-semibold">{{ total_subtasks }}</div>
				<div class="small text-muted">Completed: {{ completed_subtasks }}</div>
			</div>
		</div>
	</div>
</div>

<div class="row g-4">
	<div class="col-lg-6">
		<div class="card">
			<div class="card-header">Assignments</div>
			<div class="card-body">
				{% if tasks %}
					<ul class="list-group list-group-flush">
						{% for task in tasks %}
							<li class="list-group-item">
								<div class="fw-semibold">{{ task.title }}</div>
								<small class="text-muted">
									{{ task.module_code or "Module" }} Â·
									{% if task.due_at %}Due {{ task.due_at | irish_datetime }}{% elif task.due_date %}Due {{ task.due_date | irish_date }}{% endif %}
								</small>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-muted mb-0">No assignments in this date range.</p>
				{% endif %}
			</div>
		</div>
	</div>
	<div class="col-lg-6">
		<div class="card">
			<div class="card-header">Calendar Events</div>
			<div class="card-body">
				{% if events %}
					<ul class="list-group list-group-flush">
						{% for ev in events %}
							<li class="list-group-item">
								<div class="fw-semibold">{{ ev.title }}</div>
								<small class="text-muted">
									{% if ev.module_code %}{{ ev.module_code }} Â· {% endif %}
									{% if ev.time %}{{ ev.time }}{% endif %}
									{% if ev.first %} Â· {{ ev.first | irish_date }}{% endif %}
									{% if ev.last %} â†’ {{ ev.last | irish_date }}{% endif %}
									{% if ev.count %} Â· {{ ev.count }} occurrences{% endif %}
								</small>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-muted mb-0">No events in this date range.</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<div class="row g-4 mt-1">
	<div class="col-lg-6">
		<div class="card">
			<div class="card-header">Assignment Reviews</div>
			<div class="card-body">
				{% if reviews %}
					<ul class="list-group list-group-flush">
						{% for review in reviews %}
							<li class="list-group-item">
								<div class="fw-semibold">
									{% if review.filename %}{{ review.filename }}{% else %}Text Review{% endif %}
								</div>
								<small class="text-muted">
									{{ review.task_title or "Unlinked" }}{% if review.module_code %} ({{ review.module_code }}){% endif %}
									Â· {{ review.reviewed_at | irish_datetime }}
								</small>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-muted mb-0">No reviews in this date range.</p>
				{% endif %}
			</div>
		</div>
	</div>
	<div class="col-lg-6">
		<div class="card">
			<div class="card-header">Microtasks</div>
			<div class="card-body">
				{% if subtasks %}
					<ul class="list-group list-group-flush">
						{% for item in subtasks %}
							<li class="list-group-item">
								<div class="fw-semibold">{{ item.title }}</div>
								<small class="text-muted">
									{{ item.task_title }}{% if item.module_code %} ({{ item.module_code }}){% endif %}
								</small>
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-muted mb-0">No microtasks in this date range.</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<div class="row g-4 mt-1">
	<div class="col-lg-12">
		<div class="card">
			<div class="card-header">Lecturer Messages</div>
			<div class="card-body">
				{% if lecturer_messages %}
					<ul class="list-group list-group-flush">
						{% for item in lecturer_messages %}
							<li class="list-group-item">
								<div class="fw-semibold">{{ item.subject }}</div>
								<small class="text-muted">
									To {{ item.lecturer_name or "Lecturer" }} Â· {{ item.sent_at | irish_datetime }}
								</small>
								{% if item.message %}
									<div class="small text-muted mt-2" style="white-space: pre-wrap;">{{ item.message }}</div>
								{% endif %}
							</li>
						{% endfor %}
					</ul>
				{% else %}
					<p class="text-muted mb-0">No lecturer messages in this date range.</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>
{% endblock %}
