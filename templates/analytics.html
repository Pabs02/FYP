{% extends 'base.html' %}
{% block content %}
<h2 class="mb-4">Analytics Dashboard</h2>

<!-- Summary Cards -->
<div class="row g-4 mb-4">
	<div class="col-md-3">
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title">{{ analytics.total_tasks }}</h5>
				<p class="card-text">Total Tasks</p>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title text-success">{{ analytics.completed_tasks }}</h5>
				<p class="card-text">Completed</p>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title text-warning">{{ analytics.in_progress_tasks }}</h5>
				<p class="card-text">In Progress</p>
			</div>
		</div>
	</div>
	<div class="col-md-3">
		<div class="card text-center">
			<div class="card-body">
				<h5 class="card-title text-info">{{ analytics.pending_tasks }}</h5>
				<p class="card-text">Pending</p>
			</div>
		</div>
	</div>
</div>

<!-- Charts Row -->
<div class="row g-4">
	<div class="col-md-6">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0">Weekly Task Completions</h5>
			</div>
			<div class="card-body">
				{% if analytics.weekly_data %}
					<div class="chart-container" style="height: 300px;">
						{% for week in analytics.weekly_data %}
						<div class="d-flex align-items-end mb-2">
							<div class="me-2" style="width: 80px; font-size: 12px;">{{ week.week }}</div>
							<div class="flex-grow-1">
								<div class="progress" style="height: 20px;">
									<div class="progress-bar bg-primary" role="progressbar" 
										 style="width: {{ (week.completions / analytics.max_weekly_completions * 100) }}%"
										 aria-valuenow="{{ week.completions }}" aria-valuemin="0" aria-valuemax="{{ analytics.max_weekly_completions }}">
										{{ week.completions }}
									</div>
								</div>
							</div>
						</div>
						{% endfor %}
					</div>
				{% else %}
					<p class="text-muted">No completion data available</p>
				{% endif %}
			</div>
		</div>
	</div>
	
	<div class="col-md-6">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0">On-time vs Late Completion</h5>
			</div>
			<div class="card-body">
				{% if analytics.completion_stats %}
					<div class="text-center mb-3">
						<h3>{{ analytics.completion_stats.total_completed }}</h3>
						<p class="text-muted">Total Completed Tasks</p>
					</div>
					
					<div class="row">
						<div class="col-6 text-center">
							<div class="p-3 border rounded">
								<h4 class="text-success">{{ analytics.completion_stats.on_time }}</h4>
								<p class="mb-0">On Time</p>
								<small class="text-muted">{{ analytics.completion_stats.on_time_percentage }}%</small>
							</div>
						</div>
						<div class="col-6 text-center">
							<div class="p-3 border rounded">
								<h4 class="text-danger">{{ analytics.completion_stats.late }}</h4>
								<p class="mb-0">Late</p>
								<small class="text-muted">{{ analytics.completion_stats.late_percentage }}%</small>
							</div>
						</div>
					</div>
					
					<div class="mt-3">
						<div class="progress" style="height: 25px;">
							<div class="progress-bar bg-success" role="progressbar" 
								 style="width: {{ analytics.completion_stats.on_time_percentage }}%">
								On Time: {{ analytics.completion_stats.on_time_percentage }}%
							</div>
							<div class="progress-bar bg-danger" role="progressbar" 
								 style="width: {{ analytics.completion_stats.late_percentage }}%">
								Late: {{ analytics.completion_stats.late_percentage }}%
							</div>
						</div>
					</div>
				{% else %}
					<p class="text-muted">No completion data available</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

<!-- Additional Analytics -->
<div class="row g-4 mt-4">
	<div class="col-md-12">
		<div class="card">
			<div class="card-header">
				<h5 class="mb-0">Module Performance</h5>
			</div>
			<div class="card-body">
				{% if analytics.module_stats %}
					<div class="table-responsive">
						<table class="table table-striped">
							<thead>
								<tr>
									<th>Module</th>
									<th>Total Tasks</th>
									<th>Completed</th>
									<th>Completion Rate</th>
									<th>Progress</th>
								</tr>
							</thead>
							<tbody>
								{% for module in analytics.module_stats %}
								<tr>
									<td><strong>{{ module.module_code }}</strong></td>
									<td>{{ module.total_tasks }}</td>
									<td>{{ module.completed }}</td>
									<td>{{ module.completion_rate }}%</td>
									<td>
										<div class="progress" style="height: 20px;">
											<div class="progress-bar" role="progressbar" 
												 style="width: {{ module.completion_rate }}%"
												 aria-valuenow="{{ module.completion_rate }}" aria-valuemin="0" aria-valuemax="100">
												{{ module.completion_rate }}%
											</div>
										</div>
									</td>
								</tr>
								{% endfor %}
							</tbody>
						</table>
					</div>
				{% else %}
					<p class="text-muted">No module data available</p>
				{% endif %}
			</div>
		</div>
	</div>
</div>

{% endblock %}
