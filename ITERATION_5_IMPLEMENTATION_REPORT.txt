================================================================================
ITERATION 5 IMPLEMENTATION REPORT
Smart Student Planner (FYP)
Date: 2026-02-12
================================================================================

This document summarizes what was implemented in this iteration, the database
changes applied, deployment work completed, and the key technical problems and
struggles encountered with their fixes.


1) ITERATION 5 FEATURES COMPLETED (CODE + DATABASE VERIFIED)
--------------------------------------------------------------------------------

US 17 - Per-Module Dashboard (Completed)
- Added module overview route: /modules
- Added module detail route: /modules/<module_id>
- Added per-module metrics:
  - task totals and completion rates
  - average grade
  - weekly completion chart
- Added lecture attendance statistics per module.

US 18 - More Analytics Visuals (Completed)
- Extended /analytics with:
  - weekly completions
  - on-time vs late completion view
  - module radar
  - cumulative progress chart
  - grade distribution
  - workload timeline
- Added Health Score logic:
  - combines task completion, on-time rate, lecture attendance.

US 19 - Voice to Task Capture Expansion (Completed)
- Added intent-based voice command endpoint: /voice-command
- Supports:
  - dashboard query voice intents (due this week, overdue)
  - recurring calendar event creation
  - microtask breakdown generation
- Added frontend voice widgets to:
  - Home (index)
  - Calendar
  - Microtasks

US 21 - Group Project Workspace (Completed)
- Added full /group-workspace area with:
  - project creation
  - member management and invite flow
  - AI/manual task breakdown
  - task assignment and update workflows
  - milestones
  - task/project file uploads
  - project messaging thread
  - assignment email actions
- Added invite acceptance route:
  - /group-workspace/invite/<invite_token>

US 22 - Export Schedule to Calendar Clients (Completed)
- Added ICS export route:
  - /export/calendar.ics
- Supports export of tasks and calendar events for import into Google/Outlook.

Semester Overview Improvements (Completed)
- Added group project progress stats in /semester.
- Added lecture attendance stats in /semester.

Web Deployment (Completed)
- App deployed and live on Render:
  - https://fyp-hcpp.onrender.com
- Added deployment setup:
  - gunicorn dependency
  - wsgi.py
  - /healthz endpoint
  - .python-version


2) DATABASE CHANGES APPLIED
--------------------------------------------------------------------------------

Group Workspace schema and incremental updates:
- scripts/add_group_workspace_tables.sql
- scripts/add_group_workspace_extras.sql

Lecture attendance tracking:
- scripts/add_lecture_attendance_table.sql

Other supporting tables/scripts already used by related features:
- scripts/add_calendar_events_table.sql
- scripts/add_activity_logs_table.sql
- scripts/add_subtasks_table.sql
- scripts/add_subtask_completion.sql


3) MAJOR PROBLEMS / STRUGGLES ENCOUNTERED + FIXES
--------------------------------------------------------------------------------

Problem A: "Delete All" recurring events action not removing correct records
- Cause:
  Python weekday numbering and PostgreSQL DOW numbering mismatch.
- Fix:
  Converted Python weekday -> PostgreSQL DOW mapping and tightened matching logic.

Problem B: Attendance check-in showed manual events (e.g., Bar work)
- Cause:
  Attendance query included recurring/manual events.
- Fix:
  Filter changed to Canvas-synced events only (canvas_event_id IS NOT NULL).

Problem C: Attendance updated in analytics but not in modules
- Cause:
  Some Canvas events had NULL module_id.
- Fix:
  Added fallback module matching from event title (supports full and short module
  code matching patterns).

Problem D: Logout not working on deployed app
- Cause:
  Auto-login testing flag was enabled by default in production.
- Fix:
  Auto-login now disabled by default and only enabled with:
  AUTO_LOGIN_FOR_TESTING=1

Problem E: Internal Server Error on Render login
- Cause:
  SUPABASE_DATABASE_URL not set in Render Environment Variables.
- Fix:
  Added required env var in Render and redeployed.

Problem F: Invite sending in Group Workspace timed out and killed worker
- Cause:
  SMTP connection from Render timed out, causing Gunicorn worker timeout.
- Fixes:
  1) Added SMTP fail-fast timeout controls.
  2) Added outbound email guard for hosted environments.
  3) Implemented Resend-first email sending with SMTP fallback:
     - Uses RESEND_API_KEY + RESEND_FROM_EMAIL when configured.

Problem G: Confusion between Render Secret Files and Environment Variables
- Cause:
  App reads values from os.getenv; secret files are not auto-exported to env.
- Fix:
  Added required values in Render Environment Variables directly.


4) DEPLOYMENT STATUS (CURRENT)
--------------------------------------------------------------------------------

- Repository pushed to GitHub main branch with all iteration changes.
- Render deployment live and health endpoint passing:
  - GET /healthz -> 200
- Group Workspace routes available in production.
- Invite email delivery now uses Resend when configured.


5) RENDER ENV VARS USED FOR PRODUCTION
--------------------------------------------------------------------------------

Required:
- SUPABASE_DATABASE_URL
- FLASK_SECRET_KEY

Feature-specific:
- OPENAI_API_KEY
- OPENAI_MODEL_NAME
- RESEND_API_KEY
- RESEND_FROM_EMAIL

Optional controls:
- DISABLE_OUTBOUND_EMAIL
- SMTP_TIMEOUT_SECONDS


6) ITERATION OUTCOME
--------------------------------------------------------------------------------

Iteration 5 delivered:
- advanced analytics and module-level progress views
- voice command expansion and frontend integration
- full group workspace capability set (including invites, files, messaging)
- attendance-based progress/health tracking
- production deployment to the web with reliability hardening

This iteration also resolved multiple deployment/runtime reliability issues that
were discovered only after moving from localhost to cloud hosting.

